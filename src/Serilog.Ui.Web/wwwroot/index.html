<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Serilog UI</title>
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="./main.css">
</head>
<body>
    <div class="wrapper d-flex align-items-stretch">
        <nav id="sidebar" class="active">
            <h1>
                <a href="#" class="logo sidebar-collapse">LU</a>
                <a href="#" class="logo sidebar-collapse">Serilog UI</a>
            </h1>
            <ul class="list-unstyled components mb-5">
                <li class="active">
                    <a href="/"><span class="fa fa-home"></span> Home</a>
                </li>
            </ul>

            <div class="footer">
                <p>
                    &copy;
                    <script>document.write(new Date().getFullYear());</script> Serilog UI |
                    <a href="https://github.com/mo-esmp/serilog-ui/">Serilog UI</a>
                </p>
            </div>
        </nav>

        <!-- Page Content  -->
        <div id="content" class="p-4 p-md-5">

            <div class="row">
                <div class="col-sm-6 col-md-6">
                    <h1>Log List</h1>
                </div>
                <div class="col-sm-6 col-md-6">
                    <button class="btn btn-outline-success float-right" data-toggle="modal" data-target="#loginModal"><i class="fa fa-unlock"></i> Authorize</button>

                    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="loginModalLabel">JWT Authorizations</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <div class="form-group row">
                                            <label for="jwtToken" class="col-sm-2 col-form-label">JWT Token:</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="jwtToken" placeholder="Bearer eyJhbGciOiJSUz...">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="loginClose">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-12 col-md-4">
                    <div class="table-select" id="logCount">
                        <label>
                            Show
                            <select asp-items="@Model.LogCountSelectListItems" name="count" class="form-control form-control-sm">
                            </select>
                            entries
                        </label>
                    </div>
                </div>
                <div class="col-sm-12 col-md-4">
                    <div class="table-select" id="logFilter">
                        <label>
                            Level
                            <select asp-items="@Model.LogLevelSelectListItems" name="level" class="form-control form-control-sm">
                            </select>
                        </label>
                    </div>
                </div>
                <div class="col-sm-12 col-md-4">
                    <div class="table-filter">
                        <label>
                            Search message:
                            <input type="search" name="search" id="search" class="form-control form-control-sm" placeholder="" value="@Model.SearchCriteria">
                        </label>
                    </div>
                </div>
            </div>

            <table class="table" id="logTable">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" class="id">#</th>
                        <th scope="col" class="level">Level</th>
                        <th scope="col" class="date">Date</th>
                        <th scope="col" class="message">Message</th>
                        <th scope="col">Exception</th>
                        <th scope="col">Properties</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var log in Model.Logs)
                    {
                    switch (log.Level)
                    {
                    case "Verbose":
                    case "Debug":
                    levelClass = "bg-success";
                    break;
                    case "Information":
                    levelClass = "bg-primary";
                    break;
                    case "Warning":
                    levelClass = "bg-warning";
                    break;
                    case "Error":
                    levelClass = "bg-danger";
                    break;
                    }

                    <tr class="@log.Level">
                        <td>@log.Id</td>
                        <td class="text-center"><span class="log-level text-white @levelClass">@log.Level</span></td>
                        <td class="text-center">@log.Timestamp</td>
                        <td class="log-message">
                            <span class="overflow-auto"><truncate length="100">@log.Message</truncate></span>
                        </td>
                        <td class="text-center">
                            @if (log.Exception != null)
                            {

                            <a href="#" title="Click to view" class="modal-trigger" data-type="text">
                                View
                                <span style="display: none">@log.Exception</span>
                            </a>
                            }
                        </td>
                        <td class="text-center">
                            <a href="#" class="modal-trigger" title="Click to view" data-type="@log.PropertyType">
                                View
                                <span style="display: none">@log.Properties</span>
                            </a>
                        </td>
                    </tr>
                    }
                </tbody>
            </table>

            <div class="row">
                <div class="col-sm-12 col-md-5">
                    <div class="table-paging-info">Showing @showingItemsStart to @showingItemsEnd of @Model.LogCount entries</div>
                </div>
                <div class="col-sm-12 col-md-7">
                    <partial name="_Paging" model="Model" />
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="./main.js"></script>
    <script>
        $(function () {
            const configObject = JSON.parse('%(Configs)');
            $.get(`/${configObject.routePrefix}/api/logs`, function (data) {
                console.log(data);
            }).fail(function (error) {
                console.log(error);
                alert("error");
            });
        });
    </script>
</body>
</html>